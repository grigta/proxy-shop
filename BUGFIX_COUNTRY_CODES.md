# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –≤—ã–±–æ—Ä–æ–º SOCKS –ø—Ä–æ–∫—Å–∏

## –ü—Ä–æ–±–ª–µ–º–∞

–ë–æ—Ç "–∑–∞–≤–∏—Å–∞–ª" –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ SOCKS –ø—Ä–æ–∫—Å–∏ –∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª –¥–∞–Ω–Ω—ã–µ –∏–∑ API.

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö –æ —Å—Ç—Ä–∞–Ω–∞—Ö:
- **–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–ª**: –∫–æ–¥—ã —Å—Ç—Ä–∞–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä: `"US"`, `"GB"`, `"CA"`)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ö—Ä–∞–Ω–∏–ª–∞**: –ø–æ–ª–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ç—Ä–∞–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä: `"United States"`, `"United Kingdom"`, `"Canada"`)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: API –Ω–µ –Ω–∞—Ö–æ–¥–∏–ª —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –∏ –≤–æ–∑–≤—Ä–∞—â–∞–ª –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫

## –†–µ—à–µ–Ω–∏–µ

### 1. –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å –º–∞–ø–ø–∏–Ω–≥–∞ —Å—Ç—Ä–∞–Ω
**–§–∞–π–ª**: `bot/utils/country_mapper.py`

–°–æ–¥–µ—Ä–∂–∏—Ç:
- –°–ª–æ–≤–∞—Ä—å `COUNTRY_CODE_TO_NAME` —Å –º–∞–ø–ø–∏–Ω–≥–æ–º –∫–æ–¥–æ–≤ –Ω–∞ –ø–æ–ª–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è (80+ —Å—Ç—Ä–∞–Ω)
- –§—É–Ω–∫—Ü–∏—è `get_country_name_from_code()` - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –∫–æ–¥ –≤ –Ω–∞–∑–≤–∞–Ω–∏–µ
- –§—É–Ω–∫—Ü–∏—è `get_country_code_from_name()` - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –≤ –∫–æ–¥
- –§—É–Ω–∫—Ü–∏—è `is_country_code()` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–¥–æ–º —Å—Ç—Ä–∞–Ω—ã

### 2. –û–±–Ω–æ–≤–ª–µ–Ω –±–æ—Ç (bot/routers/socks5.py)
**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `get_country_name_from_code` –∏–∑ `bot.utils.country_mapper`
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç –Ω–æ–≤—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π: `APITimeoutError`, `APINetworkError`
- **5 –º–µ—Å—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏** –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã –≤ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ API –≤—ã–∑–æ–≤–∞–º–∏:
  1. `callback_socks5_filter()` - —Å—Ç—Ä–æ–∫–∞ 168 (random —Ñ–∏–ª—å—Ç—Ä)
  2. `process_state_input()` - —Å—Ç—Ä–æ–∫–∞ 249 (—Ñ–∏–ª—å—Ç—Ä –ø–æ —à—Ç–∞—Ç—É)
  3. `process_city_input()` - —Å—Ç—Ä–æ–∫–∞ 306 (—Ñ–∏–ª—å—Ç—Ä –ø–æ –≥–æ—Ä–æ–¥—É)
  4. `process_zip_input()` - —Å—Ç—Ä–æ–∫–∞ 363 (—Ñ–∏–ª—å—Ç—Ä –ø–æ ZIP)
  5. `callback_show_more_proxies()` - —Å—Ç—Ä–æ–∫–∞ 519 (–ø–∞–≥–∏–Ω–∞—Ü–∏—è)
- –î–æ–±–∞–≤–ª–µ–Ω–æ debug-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –±–ª–æ–∫–∞–º–∏ –¥–ª—è `APITimeoutError` –∏ `APINetworkError`

### 3. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API (bot/services/api_client.py)
**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∫–ª–∞—Å—Å—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π:
  - `APIError` - –±–∞–∑–æ–≤–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
  - `APITimeoutError` - –¥–ª—è —Ç–∞–π–º–∞—É—Ç–æ–≤
  - `APINetworkError` - –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫
- –í –º–µ—Ç–æ–¥–µ `_make_request()` –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:
  - `httpx.TimeoutException` ‚Üí `APITimeoutError`
  - `httpx.NetworkError` ‚Üí `APINetworkError`
  - –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP –æ—à–∏–±–æ–∫ —Å –∫–æ–¥–æ–º —Å—Ç–∞—Ç—É—Å–∞ –∏ —Ç–µ–∫—Å—Ç–æ–º –æ—Ç–≤–µ—Ç–∞

### 4. Backend –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ —Ñ–æ—Ä–º–∞—Ç–∞ (backend/services/product_service.py)
**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- –î–æ–±–∞–≤–ª–µ–Ω —Å–ª–æ–≤–∞—Ä—å `COUNTRY_CODE_TO_NAME` (–∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π –±–æ—Ç—É)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `normalize_country()` –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∫–æ–¥–æ–≤ –≤ –Ω–∞–∑–≤–∞–Ω–∏—è
- –û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `get_products_filtered()`:
  - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `country` –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º –∫ –ë–î
  - Debug-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–Ω–æ–≥–æ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
- –û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `get_available_states()`:
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–∫ –∫–æ–¥–æ–≤, —Ç–∞–∫ –∏ –Ω–∞–∑–≤–∞–Ω–∏–π —Å—Ç—Ä–∞–Ω
  - Debug-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: backend –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏ –∫–æ–¥—ã, –∏ –ø–æ–ª–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è
- **–ì–∏–±–∫–æ—Å—Ç—å**: –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–π —Ñ–æ—Ä–º–∞—Ç –≤ API –∑–∞–ø—Ä–æ—Å–∞—Ö
- **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å**: –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Å—Ç—Ä–∞–Ω—É "USA" ‚Üí –±–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–¥ `"US"`
2. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `country="US"` –≤ API
3. Backend –∏—â–µ—Ç `{"country": "US"}` –≤ –ë–î
4. –ë–î —Ö—Ä–∞–Ω–∏—Ç `{"country": "United States"}`
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: 0 —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π ‚Üí "–ü—Ä–æ–∫—Å–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Å—Ç—Ä–∞–Ω—É "USA" ‚Üí –±–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–¥ `"US"`
2. –ë–æ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç `"US"` ‚Üí `"United States"` —á–µ—Ä–µ–∑ `get_country_name_from_code()`
3. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `country="United States"` –≤ API
4. Backend –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): `"United States"` ‚Üí `"United States"`
5. Backend –∏—â–µ—Ç `{"country": "United States"}` –≤ –ë–î
6. –ë–î —Ö—Ä–∞–Ω–∏—Ç `{"country": "United States"}`
7. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–æ–≤–ø–∞–¥–µ–Ω–∏—è –Ω–∞–π–¥–µ–Ω—ã ‚Üí –ø—Ä–æ–∫—Å–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- **–¢–∞–π–º–∞—É—Ç**: "‚è± –°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."
- **–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞**: "üåê –û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ."
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ –æ–±—â–∏—Ö –æ—à–∏–±–æ–∫

### Debug-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–í—Å–µ –º–µ—Å—Ç–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç:
```python
logger.debug(f"Fetching SOCKS5 proxies: country_code={country_code}, country_name={country_name}")
```

–ü–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å —Ä–∞–±–æ—Ç—É –º–∞–ø–ø–∏–Ω–≥–∞ –≤ –ª–æ–≥–∞—Ö.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å Python:
- ‚úÖ `bot/utils/country_mapper.py`
- ‚úÖ `bot/routers/socks5.py`
- ‚úÖ `bot/services/api_client.py`
- ‚úÖ `backend/services/product_service.py`

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞** –∏ –≤—ã–±—Ä–∞—Ç—å —Å—Ç—Ä–∞–Ω—É "USA"
2. **–í—ã–±—Ä–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä** "RANDOM"
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏**: –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞ —Å `country_code=US, country_name=United States`
4. **–£–±–µ–¥–∏—Ç—å—Å—è**, —á—Ç–æ –ø—Ä–æ–∫—Å–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è (–µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å –≤ –ë–î)
5. **–ü–æ–≤—Ç–æ—Ä–∏—Ç—å** –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ (STATE, CITY, ZIP)
6. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é** ("–ü–æ–∫–∞–∑–∞—Ç—å –µ—â–µ")

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å—Ç—Ä–∞–Ω—ã

–ú–∞–ø–ø–∏–Ω–≥ –≤–∫–ª—é—á–∞–µ—Ç 80+ —Å—Ç—Ä–∞–Ω:
- üá∫üá∏ US ‚Üí United States
- üá¨üáß GB ‚Üí United Kingdom
- üá®üá¶ CA ‚Üí Canada
- üá©üá™ DE ‚Üí Germany
- üá´üá∑ FR ‚Üí France
- ...–∏ –¥—Ä—É–≥–∏–µ

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–º. –≤ —Ñ–∞–π–ª–∞—Ö:
- `bot/utils/country_mapper.py`
- `backend/services/product_service.py`

## –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω—ã
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω—ã, –æ–±–Ω–æ–≤–∏—Ç–µ —Å–ª–æ–≤–∞—Ä—å –≤ **–æ–±–æ–∏—Ö** —Ñ–∞–π–ª–∞—Ö:

1. `bot/utils/country_mapper.py`:
```python
COUNTRY_CODE_TO_NAME = {
    # ... existing entries ...
    "XX": "New Country Name",
}
```

2. `backend/services/product_service.py`:
```python
COUNTRY_CODE_TO_NAME = {
    # ... existing entries ...
    "XX": "New Country Name",
}
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
–ú–æ–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ —Å–ª–æ–≤–∞—Ä—å –≤ –æ–±—â–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è.

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. ‚ú® **–ù–æ–≤—ã–π**: `bot/utils/country_mapper.py` (151 —Å—Ç—Ä–æ–∫–∞)
2. üìù **–ò–∑–º–µ–Ω–µ–Ω**: `bot/routers/socks5.py` (+–∏–º–ø–æ—Ä—Ç—ã, +–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ 5 –º–µ—Å—Ç–∞—Ö, +–æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫)
3. üìù **–ò–∑–º–µ–Ω–µ–Ω**: `bot/services/api_client.py` (+–∫–ª–∞—Å—Å—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π, +–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤/—Å–µ—Ç–∏)
4. üìù **–ò–∑–º–µ–Ω–µ–Ω**: `backend/services/product_service.py` (+–º–∞–ø–ø–∏–Ω–≥, +normalize_country(), –æ–±–Ω–æ–≤–ª–µ–Ω—ã 2 –º–µ—Ç–æ–¥–∞)
5. üìù **–ù–æ–≤—ã–π**: `BUGFIX_COUNTRY_CODES.md` (—ç—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

## –ê–≤—Ç–æ—Ä –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

Claude Code Agent (2025)

---

**–î–∞—Ç–∞**: 2025-11-18
**–í–µ—Ä—Å–∏—è**: 1.0
